version: '3.8'

services:
  servo:
    build:
      context: .
    restart: always
    tty: true
    logging:
      driver: json-file
      options:
        max-size: 200k
        max-file: "10"
    environment:
      - SERVO_ENV=${SERVO_ENV:-development}
      - OPSANI_OPTIMIZER=${OPSANI_OPTIMIZER:?Opsani Optimizer must be configured}
      - OPSANI_TOKEN=${OPSANI_TOKEN}      
    volumes:
      - type: bind
        source: ./servo.yaml
        target: /servo/servo.yaml
        read_only: true
      - type: bind
        source: ${OPSANI_TOKEN_FILE:-/dev/null}
        target: /var/run/secrets/opsani.com/optimizer.token
        read_only: true
